# lab-riscv-asm

Лабораторная работа №1 lab-riscv-asm

## Вариант задания
Вариант 4

Вариант задания | Передача параметров
--------------- | -------------
Найти сумму положительных элементов массива.
(N = 4, M = 2) | По значению 

## Результаты работы

* **lab1.S** - программа на RISC-V ASM
* **lab1.c** - программа на Си
* **lab1.dump** - дамп-файл программы на Си
* **Makefile** - файл для сборки программы на Си
## Выполнение работы
Корректность работы программы на ассемблере RISCV можно проверить с помощью симулятора [venus](https://www.kvakil.me/venus/)

Сборка программы на Си в полностью настроенном окружении выполняется с использованием GNU Make. Для этого, находясь в каталоге с `Makefile` необходимо выполнить команду:
```
make
```
## Анализ [lab1.dump](https://github.com/iAnt0n/lab-riscv-asm/blob/master/lab1.dump)
Начало вызываемой процедуры для вычисления суммы положительных чисел в массиве *sum_of_positive*
```
00010140 <sum_of_positive>:
   10140:	fc010113          	addi	sp,sp,-64
```
Начало вызываемой процедуры для заполнения массива числами *fill_matrix*
```
00010238 <fill_matrix>:
   10238:	fd010113          	addi	sp,sp,-48
```
Начало *main*
```
0001031c <main>:
   1031c:	fd010113          	addi	sp,sp,-48
```

### Анализ main
В начале изменяется значение *sp* и в стек помещаются значения `*ra* и *s0*. Это необходимо, так как *main* является callee и должна сохранить значения этих регистров неизменными по завершению работы. В концепроцедуры эти сохранненые значения возвращаются в регистры *ra* и *r0*, восстанавливается *sp*
```
1031c:	fd010113          	addi	sp,sp,-48
10320:	02112623          	sw	ra,44(sp)
10324:	02812423          	sw	s0,40(sp)
```
```
10370:	02c12083          	lw	ra,44(sp)
10374:	02812403          	lw	s0,40(sp)
10378:	03010113          	addi	sp,sp,48
1037c:	00008067          	ret
```
Передача аргументов в функции *fill_matrix* и *sum_of_positive* производится одинаково через регистры *a0*, *a1* (количество строк и столбцов соответственно) и *a2* (адрес первого элемента массива)
```
10330:	00078613          	mv	a2,a5
10334:	00400593          	li	a1,4
10338:	00200513          	li	a0,2
1033c:	efdff0ef          	jal	ra,10238 <fill_matrix>
```
```
10344:	00078613          	mv	a2,a5
10348:	00400593          	li	a1,4
1034c:	00200513          	li	a0,2
10350:	df1ff0ef          	jal	ra,10140 <sum_of_positive>
```
### Анализ sum_of_positive
В начале процедуры аналогично main сдвигается *sp*, сохраняются *ra*, *s0*, *s1*, в конце процедуры восстанавливаются
```
10140:	fc010113          	addi	sp,sp,-64
10144:	02112e23          	sw	ra,60(sp)
10148:	02812c23          	sw	s0,56(sp)
1014c:	02912a23          	sw	s1,52(sp)
```
Аргументы, переданные через регистры *a0*, *a1*, *a2* сохраняются в стек и при необходимости загружаются из него же.
```
10150:	04010413          	addi	s0,sp,64
10154:	fca42623          	sw	a0,-52(s0)
10158:	fcb42423          	sw	a1,-56(s0)
1015c:	fcc42223          	sw	a2,-60(s0)
```
```
101b8:	fc442703          	lw	a4,-60(s0)
...
101fc:	fc842783          	lw	a5,-56(s0)
...
10214:	fcc42783          	lw	a5,-52(s0)
```
Проверка текущего элемента на положительность
```
101d8:	0007ca63          	bltz	a5,101ec <sum_of_positive+0xac>
```
Сравнение индекса текущего столбца с количеством столбцов
```
101fc:	fc842783          	lw	a5,-56(s0)
10200:	f8f74ee3          	blt	a4,a5,1019c <sum_of_positive+0x5c>
```
Сравнение индекса текущей строки с количеством строк
```
10214:	fcc42783          	lw	a5,-52(s0)
10218:	f6f74ee3          	blt	a4,a5,10194 <sum_of_positive+0x54>
```
Возврат результата функции производится через регистр a0
```
1021c:	fec42783          	lw	a5,-20(s0)
10220:	00078513          	mv	a0,a5
```
### Структура fill_matrix аналогична sum_of_positive, так как в ней тоже обрабатывается двумерный массив.

## Вывод
В ходе выполнения данной лабораторной работы были изучены основные инструкции ассемблера RISC-V, написаны программы для обработки двумерного массива на ассемблере и на языке C, произведен анализ дамп-файла и произведен отличный отдых от Soft Skills и Креативных технологий. Так же из-за данной лабораторной случайно начал пользоваться Vim.
